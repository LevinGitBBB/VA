<div *ngIf="isAuthenticated">

  
<!-- Income Section -->
<div class="income-form">
  <mat-form-field appearance="fill" class="w-48">
    <mat-label>Monthly Income</mat-label>
    <input
      matInput
      type="number"
      min="0"
      step="0.01"
      [(ngModel)]="income"
      (click)="enableIncomeSave()"
      style="text-align: right;"
      class="no-arrows"
    />
<span matSuffix style="position: relative; top: 6px;">CHF</span>
  </mat-form-field>
  <button *ngIf="showIncomeSave" class="btn button2" (click)="saveIncome()">Save Income</button>
</div>

<!-- Table -->
<div *ngIf="isAuthenticated">

  <div class="page-title">Budget</div>
  <div class="page-desc">View and manage your Budget </div>
    <div *ngIf="!editMode">
        <div *ngFor="let budgetEntry of budgetEntries; let i = index">
        <div class="content-bar">
          <div class="itemtitle">{{ budgetEntry.group }}</div>
          <div class="itemstock">{{ budgetEntry.title }}</div>
          <div class="itemprice">{{ budgetEntry.value }} CHF</div>
          <div class="btncontainer">
          <button (click)="onEdit(budgetEntry.id)" class="cbbtn"><i class="fa fa-pencil" aria-hidden="true"></i></button>
          <button (click)="onDelete(budgetEntry.id)" class="cbbtn"><i class="fa fa-trash-o" aria-hidden="true"></i></button>
          </div>
        </div>
      </div>
    </div>

      <!-- Edit mode: show only the entry being edited -->
  <div *ngIf="editMode">
    <div *ngFor="let budgetEntry of budgetEntries">
      <div *ngIf="budgetEntry.id === editingEntryId" class="content-bar">
        <div class="itemtitle">{{ budgetEntry.group }}</div>
        <div class="itemstock">{{ budgetEntry.title }}</div>
        <div class="itemprice">{{ budgetEntry.value }} CHF</div>
        <div class="btncontainer">
          <button (click)="onEdit(budgetEntry.id)" class="cbbtn">
            <i class="fa fa-pencil" aria-hidden="true"></i>
          </button>
          <button (click)="onDelete(budgetEntry.id)" class="cbbtn">
            <i class="fa fa-trash-o" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <p class="right-p"  *ngIf="!editMode">
    <button class="btn button2" (click)="toggleForm()">
      {{ showForm ? 'X' : 'Add an Object' }}
    </button>
  </p>


  <div *ngIf="showForm" class="enter-container" [class.visible]="showForm">
    <form (ngSubmit)="onSubmit()" [formGroup]="budgetForm">
      <div class="form-group">
        <label for="group">Group</label>
        <select id="group" class="form-control" formControlName="group">
          <option [ngValue]="null" disabled>Select a group</option>
          <option *ngFor="let g of groups" [ngValue]="g">{{ g.name }}</option>
        </select>

        <label for="title">Title</label>
        <input type="text" class="form-control" formControlName="title">

        <label for="value">Value</label>
        <input type="number" class="form-control" formControlName="value">
        <div *ngIf="budgetForm.get('value')?.invalid && budgetForm.get('value')?.touched" class="text-danger">
          Value must be a number
        </div>
      </div>

      <button class="btn btn-success" [disabled]="budgetForm.invalid">
        {{ editMode ? 'Update Ausgabe' : 'Add Ausgabe' }}
      </button>
    </form>
  </div>
</div>


